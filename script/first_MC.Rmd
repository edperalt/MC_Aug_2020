---
title: "Montecarlo simulation sensitivity"

date: "8/22/2020"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}

library(MonteCarlo)
library(tidyverse)


```

# Montecarlo excercise

## Description  
This is an excercise to test set of montecarlo simulations to estimate the STOOIP of a field. We will compare to sets of distributions, one with 100 samples and one with 1e6. We will also compare the changes in the results when increaing the number of simulations. In the graphs p10, p50 and p90 will be shown as reference. The excercise will be repeated with a series of distributions created with 1e6  samples.  

```{r message=FALSE, warning=FALSE, include=FALSE}
df_sample <- 1e2
```



```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

## 
df <- 
  data.frame(area = runif( df_sample, 5, 12)) 
  
  
area_a<-                ## the plots with a will be the ones with the small distribution
  ggplot(df, aes(area))+
  geom_histogram(fill = "grey", bins = 20) +
  labs(x = "Area km2" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())+
  scale_x_continuous(limits = c(0,15))




```




```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

## thickness

df$thk  <-  runif(df_sample, 8, 17)
  
  
thk_a<-
  ggplot(df, aes(thk))+
  geom_histogram(fill = "grey", bins = 20) +
  labs(x = "Thickness in meters" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())+
   scale_x_continuous(limits = c(5,20))


```





```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}
## Porosity


df$poro  <- rnorm(df_sample, 0.2, 0.03)
  
  
poro_a<-
  ggplot(df, aes(poro))+
  geom_histogram(fill = "grey", bins = 30) +
  labs(x = "Porosity in fraction" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())+
  scale_x_continuous(limits = c(0.05, 0.3),
                     breaks = seq(0.05, 0.3, 0.05),
                     labels = seq(0.05, 0.3, 0.05))


```


## Reservoir water  saturation in fraction with `r df_sample` samples  


```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

df$sw  <- rnorm(df_sample, 0.22, 0.04)
  
df<- df %>% mutate(sw = ifelse( sw < 0 , 0 ,  sw ) )
  
sw_a<-ggplot(df, aes(sw))+
  geom_histogram(fill = "grey", bins = 30) +
  labs(x = "Porosity in fraction" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())+
  scale_x_continuous(limits = c(0.05, 0.35),
                     breaks = seq(0.1, 0.35, 0.05),
                     labels = seq(0.1, 0.35, 0.05))


```


```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

df$bo  <- rnorm(df_sample, 1.07, 0.02)
  
  
bo_a<-ggplot(df, aes(bo))+
  geom_histogram(fill = "grey", bins = 30) +
  labs(x = "Porosity in fraction" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())+
  scale_x_continuous(limits = c(1, 1.12),
                     # breaks = seq(0.1, 0.35, 0.05),
                     # labels = seq(0.1, 0.35, 0.05)
                     )


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples_a <- 1e2
```

## Montecarlo,  `r mc_samples` simulations  

```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples_a  ))

mc_stooip$area <- sample(df$area, size = mc_samples_a, replace = TRUE)
mc_stooip$thk  <- sample(df$thk,  size = mc_samples_a, replace = TRUE)
mc_stooip$poro <- sample(df$poro, size = mc_samples_a, replace = TRUE)
mc_stooip$sw   <- sample(df$sw,   size = mc_samples_a, replace = TRUE)
mc_stooip$bo   <- sample(df$bo,   size = mc_samples_a, replace = TRUE)

mc_stooip <- 
  mc_stooip %>%
    mutate(stooip = area *
             1e6 *        # to get to meters
             thk *
             6.28 *       # transform into bbls
             poro *
             (1-sw) /
             bo
             )
# for (i in 1:mc_samples) {
#   mc_stooip[i,"stooip"]<- 
#     sample(df$area, size = 1) * 
#     1e6 *
#     sample(df$thk, size = 1) *
#     6.28*
#      sample(df$poro, size = 1)*
#      ( 1 - sample(df$sw, size = 1 )) 
#     
# }

stooip_1e2_a<-
ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```



```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples_a <- 1e3
```



## STOOIP Montecarlo,  `r mc_samples` simulations  

```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

mc_stooip <- data.frame(id = seq(1 , mc_samples_a  ))

mc_stooip$area <- sample(df$area, size = mc_samples_a, replace = TRUE)
mc_stooip$thk  <- sample(df$thk,  size = mc_samples_a, replace = TRUE)
mc_stooip$poro <- sample(df$poro, size = mc_samples_a, replace = TRUE)
mc_stooip$sw   <- sample(df$sw,   size = mc_samples_a, replace = TRUE)
mc_stooip$bo   <- sample(df$bo,   size = mc_samples_a, replace = TRUE)

mc_stooip <- 
  mc_stooip %>%
    mutate(stooip = area *
             1e6 *        # to get to meters
             thk *
             6.28 *       # transform into bbls
             poro *
             (1-sw) /
             bo
             )
stooip_1e3_a<-
ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e4
```



## STOOIP Montecarlo,  `r mc_samples` simulations  

```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = c(0.1, 0.5, 0.9))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e5
```



## STOOIP Montecarlo,  `r mc_samples` simulations  



```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```

```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e6
```



## STOOIP Montecarlo,  `r mc_samples` simulations  



```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```

# Second analysis with 1e6 samples  

```{r number of samples 2nd analysis, message=FALSE, warning=FALSE, include=FALSE}
df_sample <- 1e6
```

## Area of the reservoir in km^2^ with `r df_sample` samples  

```{r Area 2, echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


df <- 
  data.frame(area = runif( df_sample, 5, 12)) 
  
  
ggplot(df, aes(area))+
  geom_histogram(fill = "grey", bins = 20) +
  labs(x = "Area km2" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())




```

## Reservoir thickness in meters with `r df_sample` samples  


```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

df$thk  <-  runif(df_sample, 8, 17)
  
  
ggplot(df, aes(thk))+
  geom_histogram(fill = "grey", bins = 20) +
  labs(x = "Thickness in meters" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())


```


## Reservoir porosity in fraction with `r df_sample` samples  


```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

df$poro  <- rnorm(df_sample, 0.2, 0.03)
  
  
ggplot(df, aes(poro))+
  geom_histogram(fill = "grey", bins = 30) +
  labs(x = "Porosity in fraction" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())


```


## Reservoir water  saturation in fraction with `r df_sample` samples  


```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}

df$sw  <- rnorm(df_sample, 0.22, 0.04)
  
df<- df %>% mutate(sw = ifelse( sw < 0 , 0 ,  sw ) )
  
ggplot(df, aes(sw))+
  geom_histogram(fill = "grey", bins = 30) +
  labs(x = "Porosity in fraction" ,
       y = "")+
  theme_minimal()+
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank())


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e2
```

## Montecarlo,  `r mc_samples` simulations  

```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```



```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e3
```



## STOOIP Montecarlo,  `r mc_samples` simulations  

```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e4
```



## STOOIP Montecarlo,  `r mc_samples` simulations  

```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = c(0.1, 0.5, 0.9))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e5
```



## STOOIP Montecarlo,  `r mc_samples` simulations  



```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```




```{r message=FALSE, warning=FALSE, include=FALSE}
mc_samples <- 1e6
```



## STOOIP Montecarlo,  `r mc_samples` simulations  



```{r echo=FALSE, fig.height=2.5, fig.width=6, message=FALSE, warning=FALSE}


mc_stooip <- data.frame(id = seq(1 , mc_samples  ))
for (i in 1:mc_samples) {
  mc_stooip[i,"stooip"]<- 
    sample(df$area, size = 1) * 
    1e6 *
    sample(df$thk, size = 1) *
    6.28*
     sample(df$poro, size = 1)*
     ( 1 - sample(df$sw, size = 1 )) 
    
}

ggplot(mc_stooip, aes(stooip/1e6))+
  geom_histogram()+
  geom_vline( xintercept = quantile(mc_stooip$stooip,probs = seq(0.1, 0.9, 0.4))/1e6, color = c("blue","red", "blue" ))+
  scale_x_continuous(breaks = seq(0,250, 10))+
  labs(x= " STOIIP MM bbls")


```
